/**
 * imageDatagrid 图片分页插件 1.0.0  imageDatagrid
 * @author YuPeng
 * @param containerId 容器ID
 * @param option 参数列表
 * {
 * 	url:"", //图片分页查询地址
 *  convertor:function(itemData){}	数据转换器
 *  rows:10	,//每页显示的图片数量
 *  onload:function(){} 加载完毕后执行的函数
 *  params:{}   查询参数列表，可自定义查询参数
 * }
 * @constructor
 */
var ImageDatagrid=function(a,b){function c(a,b,c){var e,d=a?$(a).html():b;if(!d)return"";for(e in c)d=d.replace(new RegExp("{{"+e+"}}","g"),c[e]?c[e]:"");return d}this.containerId=a,this.container=$(a),this.option=b,this.total=0,this.page=1,this.pages=1,this.rows=b.rows||10,this.prevHideFlag=1,this.nextHideFlag=0,this.selectPics=[],this.temp={imagecontainer:function(){var a="";return a+="<div class='image_datagrid_image_container'>",a+="<div class='image_datagrid_container_image'><img src='{{picUrl}}' /></div>",a+="<aside class='image_datagrid_container_title'>{{picTitle}}</aside>",a+="</div>"},mainTemp:function(){var a="";return a+="<div class='image_datagrid_list'>",a+="			</div>",a+="			<div class='image_datagrid_param'>",a+="				<span class='image_datagrid_ahead'>",a+="					<svg  style='width: 1em; height: 1em;vertical-align: middle;fill: blue;overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='1286'><path d='M606.165333 115.498667L209.664 512l396.501333 396.501333a42.666667 42.666667 0 0 1-60.330666 60.330667l-426.666667-426.666667a42.666667 42.666667 0 0 1 0-60.330666l426.666667-426.666667a42.666667 42.666667 0 0 1 60.330666 60.330667z m298.666667 0L508.330667 512l396.501333 396.501333a42.666667 42.666667 0 0 1-60.330667 60.330667l-426.666666-426.666667a42.666667 42.666667 0 0 1 0-60.330666l426.666666-426.666667a42.666667 42.666667 0 0 1 60.330667 60.330667z'></path></svg>",a+="				</span>",a+="				<span class='image_datagrid_prev'>",a+="					<svg  style='width: 1em; height: 1em;vertical-align: middle;fill:blue;overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg'  ><path d='M755.498667 115.498667a42.666667 42.666667 0 0 0-60.330667-60.330667l-426.666667 426.666667a42.666667 42.666667 0 0 0 0 60.330666l426.666667 426.666667a42.666667 42.666667 0 0 0 60.330667-60.330667L358.997333 512 755.498667 115.498667z'></path></svg>",a+="				</span>",a+="				<span class='image_datagrid_current' style='width: 200px;'>第<b class='image_datagrid_current_index'>1</b>页  共<b class='image_datagrid_current_pages'>1</b>页</span>",a+="				<span class='image_datagrid_next'>",a+="					<svg  style='width: 1em; height: 1em;vertical-align: middle;fill: blue;overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg'><path d='M268.501333 908.501333a42.666667 42.666667 0 0 0 60.330667 60.330667l426.666667-426.666667a42.666667 42.666667 0 0 0 0-60.330666l-426.666667-426.666667a42.666667 42.666667 0 0 0-60.330667 60.330667L665.002667 512 268.501333 908.501333z'></path></svg>",a+="				</span>",a+="				<span class='image_datagrid_last'>",a+="					<svg  style='width: 1em; height: 1em;vertical-align: middle;fill: blue;overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' ><path d='M119.168 908.501333L515.669333 512 119.168 115.498667a42.666667 42.666667 0 1 1 60.330667-60.330667l426.666666 426.666667a42.666667 42.666667 0 0 1 0 60.330666l-426.666666 426.666667a42.666667 42.666667 0 0 1-60.330667-60.330667z m298.666667 0L814.336 512 417.834667 115.498667a42.666667 42.666667 0 0 1 60.330666-60.330667l426.666667 426.666667a42.666667 42.666667 0 0 1 0 60.330666l-426.666667 426.666667a42.666667 42.666667 0 0 1-60.330666-60.330667z'></path></svg>",a+="				</span>",a+="				<span class='image_datagrid_statistic'>总计<b class='image_datagrid_total'>0</b>条记录</span>",a+="			</div>"}},this.init=function(){var a=this,b=a.temp.mainTemp();a.container.addClass(".image_datagrid"),a.container.html(b),a.container.find(".image_datagrid_ahead").hide(),a.container.find(".image_datagrid_prev").hide(),a.requestAndUpdate(),a.eventHandler()},this.generateParams=function(){var a=this,b={};return b.page=this.page,b.rows=this.rows,b=$.extend(b,a.option.params||{})},this.updateGrid=function(){var a=this;a.container.find(".image_datagrid_current_index").text(a.page),a.container.find(".image_datagrid_current_pages").text(a.pages),a.container.find(".image_datagrid_total").text(a.total)},this.formatData=function(){var d,a=this,b=this.data;b.length>0&&(d="",$.each(b,function(b,e){e=a.option.convertor?a.option.convertor(e):a.convertor(e),d+=c("",a.temp.imagecontainer(),e)}),a.container.find(".image_datagrid_list").html(d))},this.resizeImageContainerHeight=function(){var b,a=this;b=a.container.find(".image_datagrid_container_image img").width(),a.container.find("img").attr("style","height:"+b+"px")},this.convertor=function(a){return a},this.eventHandler=function(){var a=this;$(document).delegate(a.containerId+" .image_datagrid_ahead","click",function(){a.ahead()}),$(document).delegate(a.containerId+" .image_datagrid_prev","click",function(){a.prev()}),$(document).delegate(a.containerId+" .image_datagrid_next","click",function(){a.next()}),$(document).delegate(a.containerId+" .image_datagrid_last","click",function(){a.last()}),$(document).delegate(a.containerId+" .image_datagrid_image_container img","click",function(){a.selectPic(this)})},this.ahead=function(){var a=this;a.page=1,a.requestAndUpdate(),a.hidePrev(),1==a.prevHideFlag&&a.showNext()},this.prev=function(){var a=this;a.page--,a.requestAndUpdate(),1==a.nextHideFlag&&a.showNext(),1==a.page&&a.hidePrev()},this.next=function(){var a=this;a.page++,a.requestAndUpdate(),1==a.prevHideFlag&&a.showPrev(),a.page==a.pages&&a.hideNext()},this.last=function(){var a=this;a.page=a.pages,a.requestAndUpdate(),a.hideNext(),1==a.prevHideFlag&&a.showPrev()},this.hidePrev=function(){var a=this;a.container.find(".image_datagrid_ahead").hide(),a.container.find(".image_datagrid_prev").hide(),a.prevHideFlag=1},this.showPrev=function(){var a=this;a.container.find(".image_datagrid_ahead").show(),a.container.find(".image_datagrid_prev").show(),a.prevHideFlag=0},this.hideNext=function(){var a=this;a.container.find(".image_datagrid_next").hide(),a.container.find(".image_datagrid_last").hide(),a.nextHideFlag=1},this.showNext=function(){var a=this;a.container.find(".image_datagrid_next").show(),a.container.find(".image_datagrid_last").show(),a.nextHideFlag=0},this.selectPic=function(a){var e,b=this,c=$(a),d=c.attr("src");$.inArray(d,b.selectPics)>=0?(e=$.inArray(d,b.selectPics),b.selectPics.splice(e,1),c.parent().parent().css("background-color","azure")):(b.selectPics.push(d),c.parent().parent().css("background-color","cornflowerblue"))},this.requestAndUpdate=function(){var a=this;$.getJSON(a.option.url,a.generateParams(),function(b){a.data=b.rows,a.total=b.total,a.pages=Math.ceil(a.total/a.rows),a.pages<=1&&a.hideNext(),a.formatData(),a.updateGrid(),a.option.onload&&a.option.onload(),a.resizeImageContainerHeight()})},this.clearSelect=function(){var a=this;a.selectPics=[],a.container.find(".image_datagrid_image_container").css("background-color","azure")},this.onload=function(){}};
